# Инструкция по настройке бэкенда для сохранения данных

## Что нужно сделать

### Шаг 1: Загрузить PHP-скрипт на сервер через FileZilla

1. **Откройте FileZilla** и подключитесь к серверу:
   - Хост: адрес вашего сервера (например, `ftp.yoursite.com`)
   - Пользователь: ваш FTP-логин
   - Пароль: ваш FTP-пароль
   - Порт: обычно 21 (для FTP) или 22 (для SFTP)

2. **Найдите папку с сайтом**:
   - Обычно это `public_html`, `www`, `htdocs` или `site`
   - Перейдите в папку `site/city/`

3. **Загрузите файл `save-data.php`**:
   - Перетащите файл `save-data.php` из локальной папки в папку `site/city/` на сервере
   - Убедитесь, что файл загрузился

### Шаг 2: Настроить права доступа (через FileZilla)

1. **Правой кнопкой мыши** на файле `save-data.php` → **Права доступа к файлу**
2. Установите права: **644** (или **755**)
   - Владелец: чтение, запись
   - Группа: чтение
   - Остальные: чтение

3. **Проверьте папку `resources`**:
   - Убедитесь, что папка `site/resources/` существует
   - Если нет - создайте её через FileZilla
   - Установите права на папку: **755**

4. **Проверьте файл `city-data.json`**:
   - Если файл существует, установите права: **644**
   - Если файла нет - он создастся автоматически при первом сохранении

### Шаг 3: Проверить, что PHP работает

1. Откройте в браузере: `https://ваш-сайт.ru/city/save-data.php`
2. Должна появиться ошибка "Только POST запросы разрешены" - это нормально, значит PHP работает
3. Если видите код PHP - значит PHP не установлен или не работает

### Шаг 4: Настройка через SSH (если нужно)

Если через FileZilla не получается настроить права, используйте SSH:

#### Базовые команды SSH:

1. **Подключиться к серверу**:
   ```bash
   ssh ваш_логин@адрес_сервера
   ```
   Например: `ssh user@yoursite.com`

2. **Перейти в папку с сайтом**:
   ```bash
   cd /путь/к/сайту/site/city
   ```
   Обычные пути: `/home/username/public_html/site/city` или `/var/www/html/site/city`

3. **Установить права на файл**:
   ```bash
   chmod 644 save-data.php
   ```

4. **Создать папку resources (если нет)**:
   ```bash
   cd ..
   mkdir -p resources
   chmod 755 resources
   ```

5. **Установить права на JSON-файл (если существует)**:
   ```bash
   chmod 644 resources/city-data.json
   ```

6. **Выйти из SSH**:
   ```bash
   exit
   ```

### Шаг 5: Проверка работы

1. Откройте сайт с городом
2. Откройте консоль браузера (F12 → Console)
3. Дождитесь обновления данных (каждые 10 минут)
4. В консоли должно появиться: "Данные успешно сохранены на сервер"
5. Проверьте файл `site/resources/city-data.json` - он должен обновиться

## Решение проблем

### Ошибка 403 (Forbidden)
- **Проблема**: Недостаточно прав доступа
- **Решение**: Установите права 644 на `save-data.php` и 755 на папку `resources`

### Ошибка 500 (Internal Server Error)
- **Проблема**: Ошибка в PHP-коде или нет прав на запись
- **Решение**: 
  1. Проверьте права на папку `resources` (должны быть 755)
  2. Проверьте, что PHP установлен на сервере
  3. Посмотрите логи ошибок (обычно в панели хостинга)

### Файл не создается
- **Проблема**: Нет прав на создание файла
- **Решение**: Установите права 755 на папку `resources`

### CORS ошибка
- **Проблема**: Браузер блокирует запрос
- **Решение**: В PHP-скрипте уже настроен CORS, но если проблема остаётся, добавьте ваш домен в `Access-Control-Allow-Origin`

## Безопасность (опционально)

Для большей безопасности можно ограничить доступ только с вашего домена:

В файле `save-data.php` замените:
```php
header('Access-Control-Allow-Origin: *');
```

На:
```php
header('Access-Control-Allow-Origin: https://ваш-сайт.ru');
```

## Альтернатива: если PHP не работает

Если на сервере нет PHP, можно использовать:
1. **Node.js** (если установлен)
2. **Python** (если установлен)
3. **Ручное обновление** через FileZilla (копировать данные из консоли браузера)

